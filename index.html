<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>HP Scanner ke Google Sheet</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000;
      font-family: sans-serif;
      text-align: center;
    }
    #reader {
      width: 100%;
      height: 100vh; /* penuh 1 layar */
    }
    #status {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      color: #0f0;
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: bold;
      font-size: 20px;
    }
  </style>
</head>
<body>
  <div id="reader"></div>
  <p id="status">üì∑ Siap scan...</p>

  <!-- üîä Suara OK -->
  <audio id="beepSound">
    <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" type="audio/ogg">
    <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.mp3" type="audio/mpeg">
  </audio>

  <script>
    // üîó URL Web App Google Apps Script
    const sheetURL = "https://script.google.com/macros/s/AKfycbwPZRWHrCxkoF11VHQMweNM8CXr5bWKN4ezJOMSTN8u9rjtqcWwwdM6VJvCILW8SR7M9A/exec";
    const beep = document.getElementById("beepSound");
    const statusText = document.getElementById("status");

    function sendToSheet(code) {
      statusText.innerText = "‚è≥ Mengirim...";
      statusText.style.color = "#ff0"; // kuning saat kirim

      fetch(sheetURL + "?kode=" + encodeURIComponent(code))
        .then(r => r.text())
        .then(res => {
          statusText.innerText = "‚úÖ " + code;
          statusText.style.color = "#0f0"; // hijau sukses
          beep.play(); // bunyi beep
          // langsung aktif lagi tanpa delay
          html5QrcodeScanner.render(onScanSuccess);
        })
        .catch(err => {
          statusText.innerText = "‚ùå Gagal kirim data!";
          statusText.style.color = "#f00"; // merah error
          html5QrcodeScanner.render(onScanSuccess);
        });
    }

    function onScanSuccess(decodedText, decodedResult) {
      html5QrcodeScanner.clear(); // pause dulu
      sendToSheet(decodedText);
    }

    // Start scanner fullscreen
    let html5QrcodeScanner = new Html5QrcodeScanner(
      "reader",
      { 
        fps: 30, 
        qrbox: function(viewfinderWidth, viewfinderHeight) {
          let minEdge = Math.min(viewfinderWidth, viewfinderHeight);
          return { width: minEdge * 0.8, height: minEdge * 0.8 };
        }
      }
    );
    html5QrcodeScanner.render(onScanSuccess);
  </script>
</body>
</html>
