<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>HP Scanner ke Google Sheet</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000;
      font-family: sans-serif;
      text-align: center;
    }
    #reader {
      width: 100%;
      height: 100vh; /* penuh 1 layar */
    }
    #status {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      color: #0f0;
      padding: 8px 15px;
      border-radius: 8px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="reader"></div>
  <p id="status">üì∑ Siap scan...</p>

  <!-- üîä Suara OK -->
  <audio id="beepSound">
    <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" type="audio/ogg">
    <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.mp3" type="audio/mpeg">
  </audio>

  <script>
    // üîó Ganti dengan URL Web App dari Google Apps Script
    const sheetURL = "https://script.google.com/macros/s/AKfycbwPZRWHrCxkoF11VHQMweNM8CXr5bWKN4ezJOMSTN8u9rjtqcWwwdM6VJvCILW8SR7M9A/exec";
    const beep = document.getElementById("beepSound");

    function sendToSheet(code) {
      fetch(sheetURL + "?kode=" + encodeURIComponent(code))
        .then(r => r.text())
        .then(res => {
          document.getElementById("status").innerText = "‚úÖ " + code;
          beep.play(); // üîä bunyi saat berhasil
          // aktifkan lagi scanner setelah 2 detik 2000
          setTimeout(() => {
            document.getElementById("status").innerText = "üì∑ Siap scan lagi...";
            html5QrcodeScanner.clear().then(() => {
              html5QrcodeScanner.render(onScanSuccess);
            });
          }, 100);
        })
        .catch(err => {
          document.getElementById("status").innerText = "‚ùå Gagal kirim data!";
        });
    }

    function onScanSuccess(decodedText, decodedResult) {
      // Stop sementara agar tidak double input
      html5QrcodeScanner.clear();
      sendToSheet(decodedText);
    }

    // Start scanner fullscreen
    let html5QrcodeScanner = new Html5QrcodeScanner(
      "reader",
      { 
        fps: 30, 
        qrbox: function(viewfinderWidth, viewfinderHeight) {
          let minEdge = Math.min(viewfinderWidth, viewfinderHeight);
          return { width: minEdge * 0.8, height: minEdge * 0.8 };
        }
      }
    );
    html5QrcodeScanner.render(onScanSuccess);
  </script>
</body>
</html>


